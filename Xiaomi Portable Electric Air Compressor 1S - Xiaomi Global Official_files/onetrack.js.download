!function(n,t){var e=n.document,r=n.location,i=n.navigator,o=n.console,a=n.parseInt,c=n.setTimeout,u=n.encodeURIComponent,s=n.decodeURIComponent,f=n.localStorage,l=n.sessionStorage,p=n.String,g=n.Array,v=n.Date,d=n.Function,h=n.Math,m=n.JSON,_=n.Image,w=n.XMLHttpRequest,y=n.FormData,k=n.unescape,I=n.Promise,S=n.CompressionStream,b=n.Response,C=n.Blob;function T(){return"prerender"==e.visibilityState}var x,P={}.hasOwnProperty,U=d.prototype.toString,B=U.call(n.Object);function O(n,t){var e;for(e in n)P.call(n,e)&&t(e,n[e])}function A(n){return"object"==typeof n&&null!==n&&U.call(n.constructor)===B}function L(n,e){return O(e,(function(e,r){r!==t&&(n[e]=r)})),n}function H(n,e){return O(e,(function(e,r){n[e]===t&&(n[e]=r)})),n}function z(n){n=n||{};var t,r,i,o,a={},c=e.cookie.split("; ");for(t=0;t<c.length;t++)c[t]&&(i=(r=c[t].split("=")).shift(),'"'==(o=r.join("="))[0]&&(o=o.slice(1,-1)),a[s(i)]=n.raw?o:s(o));return a}function j(n,t,r){var i=u(n)+"="+u(t);return(r=L({path:"/"},r)).expires&&(r.expires=r.expires.toUTCString()),O(r,(function(n){var t=r[n];t&&(i+="; "+n,!0!==t&&(i+="="+t))})),e.cookie=i,e.cookie}function R(n){return f?f.getItem(n):z()[n]}function M(n,t){f?f.setItem(n,t):j(n,t,{expire:new v(+new v+31536e7)})}function q(n){f?f.removeItem(n):function(n,t){j(n,"",t=L({expires:new v(v.now()-1)},t))}(n)}function D(n){return l?l.getItem(n):z()[n]}function E(n,t){l?l.setItem(n,t):j(n,t)}function F(n,t){n=n.charCodeAt(0),t=t.charCodeAt(0);for(var e="",r=n;r<=t;r++)e+=p.fromCharCode(r);return e}function J(){return x||(x=F("0","9")+F("a","z")),function(n){for(var t="",e=0;e<32;e++)t+=n[h.floor(h.random()*n.length)];return t}(x)}function G(n){var e={};return O(n,(function(n,r){e[n]=function(n,e){if(e instanceof d)try{return e(n)}catch(r){return t}return e}(n,r)})),e}var N,X="_onetrack_cid",K="_onetrack_uid",Q="_onetrack_uid_type",V="_onetrack_sid",W="_onetrack_st",Y=[3e3,1e4,3e4],Z={cn:"tracking.miui.com","in":"tracking.india.miui.com",ru:"tracking.rus.miui.com",auto:"auto.tracking.miui.com",_:"tracking.intl.miui.com"};function $(n){var t="string"==typeof n,e=N||(N=function(){for(var n=[],t=0;t<256;t++){for(var e=t,r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;n[t]=e}return n}()),r=-1;t&&(n=k(u(n)));for(var i=0;i<n.length;i++)r=r>>>8^e[255&(r^(t?n.charCodeAt(i):n[i]))];return(~r>>>0).toString(16)}function nn(n){var t=n.url,e=n.fail,r=n.data,o=n.success;"beacon"==n.transport&&i.sendBeacon?i.sendBeacon(t,r)?o():e():function(n,t){var e=new w,r=t.data,i=t.fail,o=t.success;e.open(t.method,n,!0),e.onreadystatechange=function(){if(4===e.readyState){var n={};if(200==e.status)try{n=m.parse(e.responseText)}catch(t){}0===n.code?o():i()}},e.send(r)}(t,L(n,{data:r}))}function tn(n,e){var r=new _,i={_:0+h.floor(1000000001*h.random())};O((e=e||{}).H,(function(n,t){i["H."+n]=t})),O(e.B,(function(n,t){i["B."+n]=t})),i=function(n){var e,r="";return O(n,(function(n,i){if(i!=t)if(i instanceof g)for(e=0;e<i.length;e++)r+="&"+u(n)+"="+u(i[e]);else r+="&"+u(n)+"="+u(i)})),r.substr(1)}(i),r.src=n+"?"+i+"&sign="+$(i)}var en=[].push;function rn(e,r){var i,a=[],u=0;function s(){if(a.length){var n=a.splice(0,20),t=n.length;l(n,(function(){u-=t,s()}))}}function l(t,e,i){var o=r.transport,u=r.serverUrl,s=r.serverImgUrl;if("native"==o)try{if(n.OneTrack_APP_H5_Bridge.track(m.stringify(t)))return void e()}catch(f){}u&&function(n){var t=n.data,e=n.imgUrl,r=n.success;if(I){var i=m.stringify(t),o=new y;(function(n){var t="function"==typeof S;return new I((function(e,r){return t?new b(new C([n]).stream().pipeThrough(new S("gzip"))).arrayBuffer().then((function(n){e(n)})):r()}))})(i).then((function(t){o.append("p",new C([t]),"p"),o.append("gzip",1),o.append("sign",$(new Uint8Array(t))),nn(L(n,{data:o}))}),(function(){o.append("p",new C([i]),"p"),o.append("sign",$(i)),nn(L(n,{data:o}))}))}else if(y){var a=m.stringify(t),c=new y;c.append("p",new C([a]),"p"),c.append("sign",$(a)),nn(L(n,{data:c}))}else{for(var u=0;u<t.length;u++)tn(e,t[u]);r()}}({transport:o,url:u,imgUrl:s,method:"POST",data:t,success:e,fail:function(){!function(n,t,e){var r=Y[Y.indexOf(e)+1];r?c((function(){l(n,t,r)}),r):en.apply(a,n)}(t,e,i)}})}return function(n){var l;r.limit&&u>=r.limit||(u+=1,a.push(n),i==t&&(i=c((function(){i=t,s()}))),l="_onetrack_debug",(f?null!==f.getItem(l):z()[l])&&o.log("onetrack"+e,n))}}var on={},an=0;function cn(o){if(on[o])return on[o];var c,u,s,f=o?"__"+o:"",l={},p={},g=[],d=!1,m=!1,_={send:!1,transport:"beacon"};function w(){if(d&&m){var n,e;L(l,{instance_id:(i=R(X),i||(an=1,i=J(),M(X,i)),i),session_id:b(f),uid:function(){return R(""+K+f)||t},uid_type:function(){return R(""+Q+f)||t},sdk_ver:"1.0.0",e_ts:function(){return+new v},tz:(n=(new v).getTimezoneOffset(),e=h.abs(n),"GMT"+(n>0?"-":"+")+("00"+h.floor(e/60)).slice(-2)+":"+("00"+e%60).slice(-2)),ot_test_env:R("_onetrack_test"+f)?1:t}),L(l,c),L(p,{first_open:an}),L(p,u),s=rn(f,_);for(var r=0;r<g.length;r++)try{g[r][0].apply(t,g[r][1])}catch(o){}g.length=0}var i}var y=!1;function k(n){return function(){try{var o=arguments;y||(y=!0,d=!0,w(),a={platform:"JS"},s={referrer:e.referrer,location:function(){return r.href},page:function(){return r.pathname},title:function(){return e.title},encoding:e.characterSet||e.charset,language:(i.language||i.browserLanguage||"").toLowerCase(),screen_width:screen&&screen.width,screen_height:screen&&screen.height},c=a,u=s,m=!0,w()),d&&m?n.apply(t,o):g.push([n,o])}catch(f){}var a,s}}var I=18e5;function S(n,t){if(n&&l.app_id){A(t)||(t={});var e={event:n};H(e,l),H(t,p),s({H:G(e),B:G(t)})}}function b(n){return function(){var t=+new v,e=D(""+V+n),r=a(D(""+W+n),10);return(!e||!r||r<t-I)&&(e=J(),E(""+V+n,e)),E(""+W+n,t),e}}function C(n,e,r){n!=t?M(""+K+r,n):q(""+K+r),e!=t?M(""+Q+r,e):q(""+Q+r)}return on[o]={init:k((function(e,r,i,o,a){var c,u,s;A(r)&&(i=r.region,o=r.instanceId,a=r.transport,r.sessionTimeout&&(I=r.sessionTimeout),r.limit&&(_.limit=r.limit),r=r.channel),A(o)&&(o="cookie"==o.type&&o.name?(c=o.name,u=o.options,(s=z()[c])||j(c,s=J(),L({expires:new v(+new v+31536e7)},u)),s):t),"xhr"==a&&(_.transport="xhr"),"native"==a&&n.OneTrack_APP_H5_Bridge&&(_.transport="native"),L(l,{app_id:e,channel:r||"default",instance_id:o||t,region:i}),L(_,function(n){var t=Z.cn;n&&n.toLowerCase&&(n=n.toLowerCase(),t=Z[n]||Z._);var e="https://"+t+"/track/v4/js";return{serverImgUrl:e,serverUrl:e+"_a"}}(i)),S("onetrack_dau")})),set:k((function(n,t){A(n)?L(p,n):p[n]=t})),track:k(S),trackPage:k((function(n){S("view",n)})),login:k((function(n,t,e,r){C(n,t,f),r||S("ot_login",e)})),logout:k((function(n){S("ot_logout",n),C(t,t,f)}))}}function un(n){return function(){try{cn("")[n].apply(t,arguments)}catch(e){}}}var sn,fn={getInstance:cn,init:un("init"),set:un("set"),track:un("track"),trackPage:un("trackPage"),login:un("login"),logout:un("logout")},ln=[].slice;function pn(n){try{var e=ln.call(arguments,1),r="",i=n.split(".");2==i.length&&(r=i[0],n=i[1]),fn.getInstance(r)[n].apply(t,e)}catch(o){}}sn=function(){var e,r=n.onetrack;if(r&&r.length||(n.onetrack=pn),(r=r&&r.q)instanceof g)for(e=0;e<r.length;e++)pn.apply(t,r[e])},T()?e.addEventListener("visibilitychange",(function gn(){T()||(e.removeEventListener("visibilitychange",gn),sn())})):sn()}(window);
